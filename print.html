<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Meson for GBA</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="install_windows.html">Installation (Windows)</a></li><li class="chapter-item expanded affix "><a href="project_setup.html">Project Setup</a></li><li class="chapter-item expanded affix "><a href="using_meson.html">Using Meson</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Meson for GBA</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>meson-gba</strong> is a toolkit for developing Game Boy Advance homebrew using the
<a href="https://mesonbuild.com" title="" target="_blank">Meson</a> build system. It aims to make building homebrew much simpler and
provides easy access to many different libraries and tools, making transitioning
from the existing Makefile-based setups easy.</p>
<p>The project is currently in beta state, and while everything has been tested
to at least compile successfully, you might run into various problems. Bug
reports are highly appreciated! You can also reach out in the <code>#sdk-seven</code>
channel in the <a href="https://discord.io/gbadev" title="" target="_blank">gbadev Discord</a> if you need help.</p>
<p>The <strong>meson-gba</strong> repository is set up such that the main branch acts as the
project template. Download dependencies with <code>meson subprojects download</code>,
and modify <strong>game/meson.build</strong> to suit your projects.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-windows"><a class="header" href="#installation-windows">Installation (Windows)</a></h1>
<p>Before we can get started, there is a few things we need to install. Mainly, we need:</p>
<ul>
<li>The meson build system</li>
<li>The git version control system</li>
<li>A compiler for your machine</li>
<li>A compiler for the GBA</li>
<li>(optional) <a href="./emulators.html">An emulator for running your game</a></li>
</ul>
<p>Compiling software on Windows has always been notoriously difficult to set up due to every program kind of arbitrarily picking its own spot to hang out in, and it can be quite tricky to get all of them to talk to each other.</p>
<p>This is why we will use MSYS2, a software development platform for Windows that provides a simple, unix-like environment with a package manager that makes everything much easier.</p>
<p>However, this also means that we’ll be doing a lot of the setup in the terminal, or “command prompt”, that funny black window you can type do all sorts of arcane things with. Not to worry, we’ll walk you through everything you need to do, and later on you can integrate everything nicely into an IDE like <a href="">VS Code</a> <sup>todo</sup></p>
<p>First, download the <a href="https://www.msys2.org/#installation" title="" target="_blank">MSYS2 installer</a>.</p>
<p>Note, if you’ve done GBA homebrew development before, you may already have a version of MSYS2 installed, using the devkitPro installer. If you wish to use this installation rather than a fresh one, read the chapter <a href="">setting up devkitPro’s MSYS</a> <sup>todo</sup>.</p>
<p>Once you have MSYS2 installed, you’ll want to open the <code>MSYS UCRT64</code> shell from your start menu.</p>
<p><strong>Important</strong>: unless specified otherwise, we will <em>always</em> use the UCRT64 shell. See <a href="">Appendix: MSYS2</a> <sup>todo</sup> for why.</p>
<p><strong>Note</strong>: “shell” is the term used for the program that runs inside a terminal and reads commands as input. Windows comes with two shells, cmd (Command Prompt) and Powershell. MSYS2 gives us the bash shell, which has many more features.</p>
<p>Once you open it, you should be greeted by a prompt that looks a little like this:</p>
<pre style="background-color:rgb(12,12,12)">
<span style="color:rgb(19,161,14)">user@computer</span> <span style="color:rgb(136,23,152)">UCRT64</span> <span style="color:rgb(193,156,0)">~</span>
<span style="color:rgb(204,204,204)">$</span>
</pre>
<p>Now, the first thing we’ll wanna do is make sure we can install packages, and update everything:</p>
<pre><code class="language-sh">pacman -Syu
</code></pre>
<p>When it asks you if you want to proceed with the installation, press enter.</p>
<p>It will most likely say something like</p>
<pre><code>:: To complete this update all MSYS2 processes including this terminal will be closed. Confirm to proceed [Y/n]
</code></pre>
<p>Press enter again, then open the UCRT64 shell.</p>
<p>Update the remaining packages with the following command:</p>
<pre><code class="language-sh">pacman -Su
</code></pre>
<p>Now that we’re all up to date, we can install everything you need, using this slightly magical incantation (you can press <code>Shift+Insert</code> to paste into the MSYS2 terminal):</p>
<pre><code class="language-sh">pacman -S ${MINGW_PACKAGE_PREFIX}-{meson,gcc,arm-none-eabi-toolchain,freeimage} git
</code></pre>
<p>When it asks you which members to install, just hit enter.</p>
<p>Once that’s done, run the following commands to verify everything is working:</p>
<pre><code class="language-sh">meson --version
ninja --version
git --version
python3 --version
gcc --version
arm-none-eabi-gcc --version
</code></pre>
<p>If all of those commands run without problems, you’re good to go!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project-setup"><a class="header" href="#project-setup">Project Setup</a></h1>
<p>Now that we have everything ready to go, let’s set up meson-gba.</p>
<p>First, navigate your terminal to wherever you like to keep your programming projects.</p>
<p>Then, download meson-gba using git, if you haven’t already done so:</p>
<pre><code class="language-sh">git clone https://github.com/LunarLambda/meson-gba
cd meson-gba
</code></pre>
<p>If you type <code>ls -1</code>, you should see the following files:</p>
<pre><code>LICENSE.txt
README.md
book
examples
game
gba.ini
meson
meson.build
subprojects
</code></pre>
<p>The <code>game</code> directory is where you will place all your game’s code and files. The <code>meson</code> directory contains files needed for configuring the compiler, and the <code>subprojects</code> directory contains files for all the libraries and programs that meson-gba lets you use.</p>
<p>Finally, you can configure some project settings in <code>meson.build</code>, although this is optional, most of your build code will be in <code>game</code>.</p>
<p>Set up your build directory:</p>
<pre><code class="language-sh">meson setup --cross-file=meson/gba.ini build
</code></pre>
<p>If everything goes well, you should see something like this at the end:</p>
<pre><code>gba-meson 0.5.0

  Subprojects
	sdk-seven  : YES

  User defined options
    Cross files: gba.ini
</code></pre>
<p><a href="https://github.com/LunarLambda/sdk-seven" title="" target="_blank">sdk-seven</a> is the project that provides all the necessary bits for building GBA programs (or ROMs).</p>
<p>Now, you should be able to compile everything:</p>
<pre><code class="language-sh">ninja -C build
</code></pre>
<p>If you look inside the <code>build/game</code> directory, you should now see a file called <code>gba-meson-template.gba</code>. Let’s try running it in an emulator:</p>
<p><img src="./img/first.png" alt="Success!" /></p>
<p>Success!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-meson"><a class="header" href="#using-meson">Using Meson</a></h1>
<p>Now that we have everything working, let’s take a look at how to use the meson build system. The <code>game</code> directory has a pre-written <code>meson.build</code> file, which you can use if you want to jump right in, but it’s pretty long, so for now, let’s start really simple, with a basic build file:</p>
<pre><code class="language-python">minrt = dependency('minrt')

elf = executable('guide-01', 'src/main.c',
  include_directories: ['include'],
  dependencies: [minrt],
  name_suffix: 'elf')

makerom = find_program('makerom')

rom = custom_target('guide-01-rom',
  input: elf,
  output: 'guide-01.gba',
  command: [makerom, '@INPUT@', '@OUTPUT@'],
  build_by_default: true)
</code></pre>
<ol>
<li>We pull in dependencies (libraries that we want to use in our code) using the <code>dependency()</code> function.</li>
<li>We build our program as an ELF file using the <code>executable()</code> function.</li>
<li>We find external programs we want to use with <code>find_program()</code>.</li>
<li>We use <code>custom_target()</code> to add custom build steps (like turning our ELF into a GBA ROM).</li>
</ol>
<p>Pretty straightforward, right?</p>
<p>Let’s add a library, to help us use the GBA’s hardware, <a href="https://github.com/LunarLambda/sdk-seven/tree/main/libseven" title="" target="_blank">libseven</a>:</p>
<pre><code class="language-python"># NEW!
libseven = dependency('libseven')
minrt = dependency('minrt')

elf = executable('guide-01', 'src/main.c',
  include_directories: ['include'],
  dependencies: [minrt, libseven], # &lt;- NEW!
  name_suffix: 'elf')

makerom = find_program('makerom')

rom = custom_target('guide-01-rom',
  input: elf,
  output: 'guide-01.gba',
  command: [makerom, '@INPUT@', '@OUTPUT@'],
  build_by_default: true)
</code></pre>
<p>And write a basic program, that draws on the screen:</p>
<pre><code class="language-c">#include &lt;seven/prelude.h&gt;
#include &lt;seven/hw/video.h&gt;
#include &lt;seven/hw/video/bg_bitmap.h&gt;
#include &lt;seven/hw/video/color_constants.h&gt;

int main(void)
{
    // To wait for V-Blank, we need some rudimentary interrupt handling
    irqInitStub();
    irqEnableFull(IRQ_VBLANK);

    // Enable video mode 3, which lets us draw pixels directly to the screen
    REG_DISPCNT = VIDEO_MODE(3) | VIDEO_BG2_ENABLE;

    struct InputState input = inputNew();

    int x = 120;
    int y = 60;

    // Our main game loop runs forever
    while (true)
    {
        // Process inputs
        input = inputPoll(input);
        x += inputAxisX(input);
        y += inputAxisY(input);

        // Make sure x and y stay on the screen (240x160 pixels)
        if (x &lt; 0) x = 0;
        if (x &gt;= 240) x = 239;

        if (y &lt; 0) y = 0;
        if (y &gt;= 160) y = 159;

        // Wait for V-Blank so we can draw to the screen without tearing
        biosVBlankIntrWait();

        // Draw a pixel to the screen
        MODE3_FRAME[y][x] = COLOR_CYAN;
    }
}
</code></pre>
<p>And if we run it… hey!</p>
<p><img src="img/basic.png" alt="" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
